@page "/addTransaction"
@using Wealth_Watcher.Model
@inject Wealth_Watcher.Services.ITransactionService transactionService
@inject Wealth_Watcher.Services.UserSessionService UserSession

<h3>Add Transaction</h3>
<h3>@errorMessage</h3>
<div class="flex justify-center items-center" style="padding-top: 100px;">
    <MudPaper Elevation="2" Square Class="pa-4" Style="background-color: white; max-height: 800px; overflow: auto;">
        <MudGrid>
            <MudItem xs="12" sm="6" Class="mb-4">
                <MudTextField @bind-Value="newTransaction.title" Label="Title" Placeholder="Enter Title" FullWidth />
            </MudItem>
            <MudItem xs="12" sm="6" Class="mb-4">
                <MudTextField @bind-Value="newTransaction.amount" Label="Price" Placeholder="Enter Price" FullWidth />
            </MudItem>
            <MudItem xs="12" sm="6" Class="mb-4">
                <MudSelect @bind-Value="newTransaction.type" Label="Type" FullWidth>
                    <MudSelectItem Value=@("Income") />
                    <MudSelectItem Value=@("Expense") />
                </MudSelect>
            </MudItem>
            <MudItem xs="12" sm="6" Class="mb-4">
                <MudSelect @bind-Value="newTransaction.tags" Label="Tags" FullWidth>
                    <MudSelectItem Value=@("Personal") />
                    <MudSelectItem Value=@("Business") />
                    <MudSelectItem Value=@("Monthly") />
                    <MudSelectItem Value=@("Rent") />
                    <MudSelectItem Value=@("Grocery") />
                    <MudSelectItem Value=@("Salary") />
                    <MudSelectItem Value=@("Other") />
                </MudSelect>
            </MudItem>
            <MudItem xs="12" sm="6" Class="mb-4">
                <MudDatePicker @bind-Value="newTransaction.transactionDate" Label="Transaction Date" PickerLabel="Select Date" FullWidth />
            </MudItem>
            <MudItem xs="12" style="display: flex; justify-content: flex-end; padding-top: 20px;">
                <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="HandleAddTransaction">Add Transaction</MudButton>
            </MudItem>
        </MudGrid>
    </MudPaper>
</div>

@code {
    private Transaction newTransaction = new Transaction();
    private string errorMessage;

    protected override void OnInitialized()
    {
        newTransaction.userId = UserSession.GetCurrentUserId();
    }

    private void HandleAddTransaction()
    {
        try
        {
            transactionService.AddTransaction(newTransaction);
            newTransaction = new Transaction();
        }
        catch (Exception e)
        {
            errorMessage = "Failed adding Transaction: " + e.Message;
        }
    }
}
